function KCVSGraph(config){var theGraph=this;for(var key in this.containerID="",this.graphID="",this.width="",this.height="",this.gmargin={top:10,right:10,bottom:40,left:60},this.xmin=0,this.xmax=1,this.ymin=0,this.ymax=1,this.xlabel="",this.ylabel="",this.xticks=5,this.yticks=5,this.xtickFormat=null,this.ytickFormat=null,this.zeroLine=!0,this.sortLinesByX=!0,this.fastTransition=50,this.slowTransition=600,this)config.hasOwnProperty(key)&&(this[key]=config[key]);this.containerID.length>0?(this.container=$("#"+this.containerID),this.container.length>0?(""==this.graphID&&(this.graphID=this.containerID+"graph"),""==this.width&&(this.width=$("#"+this.containerID).width()),""==this.height&&(this.height=$("#"+this.containerID).height()),this.wrapperID=this.graphID+"Wrapper",this.wrapper=$("<div></div>").attr("id",this.wrapperID).attr("class","kcvsGraphWrapper").appendTo(this.container),this.setMargins=function(m){this.gmargin.left=m.left,this.gmargin.right=m.right,this.gmargin.top=m.top,this.gmargin.bottom=m.bottom,this.graphWidth=this.width-this.gmargin.left-this.gmargin.right,this.graphHeight=this.height-this.gmargin.top-this.gmargin.bottom,d3.select("#"+this.graphID+"Margin").attr("transform","translate("+this.gmargin.left+","+this.gmargin.top+")")},this.svg=d3.select("#"+this.wrapperID).append("svg").attr("viewBox","0 0 "+this.width+" "+this.height).attr("preserveAspectRatio","xMinYMin meet").attr("id",this.graphID).classed("kcvsGraph",!0).append("g").attr("id",this.graphID+"Margin"),this.setMargins(this.gmargin),this.svg.append("clipPath").attr("id",this.graphID+"Clip").append("rect").attr("width",this.graphWidth).attr("height",this.graphHeight),this.xScale=d3.scaleLinear().domain([this.xmin,this.xmax]).range([0,this.graphWidth]),this.yScale=d3.scaleLinear().domain([this.ymin,this.ymax]).range([this.graphHeight,0]),this.xAxis=d3.axisBottom(this.xScale),this.yAxis=d3.axisLeft(this.yScale),this.xticks>0&&(this.xAxis=this.xAxis.ticks(this.xticks,this.xtickFormat)),this.yticks>0&&(this.yAxis=this.yAxis.ticks(this.yticks,this.ytickFormat)),this.xAxisG=this.svg.append("g").attr("transform","translate(0,"+this.graphHeight+")").attr("id",this.graphID+"Xaxis").attr("class","kcvsAxis xAxis").call(this.xAxis),this.xlabel.length>0&&$(".darkMode")[0]?this.xAxisG.append("text").attr("transform","translate("+this.graphWidth+", 0)").attr("dy","2.5em").attr("text-anchor","end").attr("fill","#d2d2d2").attr("class","kcvsAxisLabel").text(this.xlabel):this.xlabel.length>0&&this.xAxisG.append("text").attr("transform","translate("+this.graphWidth+", 0)").attr("dy","2.5em").attr("text-anchor","end").attr("fill","#000").attr("class","kcvsAxisLabel").text(this.xlabel),this.yAxisG=this.svg.append("g").attr("id",this.graphID+"Yaxis").attr("class","kcvsAxis yAxis").call(this.yAxis),this.ylabel.length>0&&$(".darkMode")[0]?this.yAxisG.append("text").attr("dy","-2.5em").attr("transform","rotate(-90)").attr("text-anchor","end").attr("fill","#d2d2d2").attr("class","kcvsAxisLabel").text(this.ylabel):this.ylabel.length>0&&this.yAxisG.append("text").attr("dy","-2.5em").attr("transform","rotate(-90)").attr("text-anchor","end").attr("fill","#000").attr("class","kcvsAxisLabel").text(this.ylabel),this.getXmin=function(){return theGraph.xScale.domain()[0]},this.getXmax=function(){return theGraph.xScale.domain()[1]},this.getYmin=function(){return theGraph.yScale.domain()[0]},this.getYmax=function(){return theGraph.yScale.domain()[1]},this.generateXarray=function(n){for(var x=new Array(n),dx=(this.getXmax()-this.getXmin())/(n-1),i=0;i<n;i++)x[i]=this.getXmin()+i*dx;return x},this.arrays2d3=function(xname,x,yname,y){var pairs=d3.zip(x,y).map((function(d){var pair={};return pair[xname]=d[0],pair[yname]=d[1],pair}));return this.sortLinesByX&&pairs.sort((function(a,b){return Number.isFinite(a[xname])?a[xname]-b[xname]:0})),pairs},this.removeInfinity=function(x,y){for(var finiteData={x:[],y:[]},i=0;i<x.length;i++)Number.isFinite(x[i])&&Number.isFinite(y[i])?(finiteData.x.push(x[i]),finiteData.y.push(y[i])):y[i]===1/0&&(finiteData.x.push(x[i]),finiteData.y.push(1.5*theGraph.getYmax()));return finiteData},this.zeroArray=function(n){for(var arr=[],i=0;i<n;i++)arr.push(0);return arr},this.line=d3.line().x((function(d){return theGraph.xScale(d.x)})).y((function(d){return theGraph.yScale(d.y)})),this.applyClipPath=function(selection){selection.attr("clip-path","url(#"+this.graphID+"Clip)")},this.addLine=function(obj){var finiteData=this.removeInfinity(obj.x,obj.y),datapairs=this.arrays2d3("x",finiteData.x,"y",finiteData.y),flatpairs=this.arrays2d3("x",finiteData.x,"y",this.zeroArray(finiteData.x.length)),lineClasses="line kcvsGraphTempNewLine";obj.hasOwnProperty("class")&&(lineClasses=lineClasses+" "+obj.class);var newline=this.svg.append("path").attr("class",lineClasses).attr("clip-path","url(#"+this.graphID+"Clip)").attr("fill","none").attr("stroke","black").attr("d",this.line(flatpairs)).datum(datapairs);return d3.select(".kcvsGraphTempNewLine").transition().duration(this.slowTransition).ease(d3.easeBackInOut).attr("d",this.line(datapairs)),newline.classed("kcvsGraphLine",!0),newline.classed("kcvsGraphTempNewLine",!1),obj.hasOwnProperty("id")?newline.attr("id",obj.id):newline.attr("id",""),newline},this.updateLine=function(id,x,y,slowUpdate){if(1==arguments.length){var obj=arguments[0];id=obj.id,x=obj.x,y=obj.y,slowUpdate=obj.slowUpdate}var trans;trans=slowUpdate?theGraph.slowTransition:theGraph.fastTransition;var finiteData=this.removeInfinity(x,y),datapairs=theGraph.arrays2d3("x",finiteData.x,"y",finiteData.y);d3.select("#"+id).transition().duration(trans).attr("d",theGraph.line(datapairs))},this.markerLines=function(markerClass,posArr,axis,slowUpdate){if(1==arguments.length){var obj=arguments[0];markerClass=obj.markerClass,posArr=obj.posArr,axis=obj.axis,slowUpdate=obj.slowUpdate}if("x"===axis||"y"===axis){var yjump=1.1*(theGraph.getYmax()-theGraph.getYmin()),t;t=slowUpdate?d3.transition().duration(this.slowTransition):d3.transition().duration(this.fastTransition);var tslow=d3.transition().duration(this.slowTransition),te=d3.easeBackOut.overshoot(1.2),pos=posArr.map((function(p,i){return point={},point.key=i,"x"===axis?(point.x1=p,point.x2=p,point.y1=theGraph.getYmin(),point.y2=theGraph.getYmax()):(point.x1=theGraph.getXmin(),point.x2=theGraph.getXmax(),point.y1=p,point.y2=p),point})),lines=this.svg.selectAll("."+markerClass).data(pos,(function(d){return d.key}));return lines.exit().transition(tslow).ease(te).style("opacity",1e-6).attr("y1",(function(d){return theGraph.yScale(d.y1+yjump)})).attr("y2",(function(d){return theGraph.yScale(d.y2+yjump)})).remove(),lines.transition(t).ease(te).style("opacity",1).attr("x1",(function(d){return theGraph.xScale(d.x1)})).attr("x2",(function(d){return theGraph.xScale(d.x2)})).attr("y1",(function(d){return theGraph.yScale(d.y1)})).attr("y2",(function(d){return theGraph.yScale(d.y2)})).attr("data-n",(function(d){return d.key})),lines.enter().append("line").style("opacity",1e-6).attr("class",markerClass).attr("fill","none").attr("x1",(function(d){return theGraph.xScale(d.x1)})).attr("x2",(function(d){return theGraph.xScale(d.x2)})).attr("y1",(function(d){return theGraph.yScale(d.y1+yjump)})).attr("y2",(function(d){return theGraph.yScale(d.y2+yjump)})).transition(tslow).ease(te).style("opacity",1).attr("y1",(function(d){return theGraph.yScale(d.y1)})).attr("y2",(function(d){return theGraph.yScale(d.y2)})),lines}console.error("Bork! axis = "+axis+" but should be x or y.")},this.zeroLine&&this.addLine({x:[this.getXmin(),this.getXmax()],y:[0,0],class:"kcvsZeroLine"}),this.markerCircles=function(circleClass,x,y,r,delay,slowUpdate){if(1==arguments.length){var obj=arguments[0];circleClass=obj.circleClass,x=obj.x,y=obj.y,r=obj.r,delay=obj.delay,slowUpdate=obj.slowUpdate}var t;t=slowUpdate?d3.transition().duration(this.slowTransition):d3.transition().duration(this.fastTransition);var tslow=d3.transition().duration(this.slowTransition),te=d3.easeBackOut.overshoot(1.2);delay&&(t.delay(delay),tslow.delay(delay));for(var dataPairs=this.arrays2d3("x",x,"y",y),i=0;i<dataPairs.length;i++)Array.isArray(r)?dataPairs[i].r=r[i]:dataPairs[i].r=r,dataPairs[i].key=i;var shapes=this.svg.selectAll("."+circleClass).data(dataPairs,(function(d){return d.key}));return shapes.exit().transition(tslow).ease(te).style("opacity",1e-6).attr("r",0).remove(),shapes.transition(t).ease(te).style("opacity",1).attr("cx",(function(d){return theGraph.xScale(d.x)})).attr("cy",(function(d){return theGraph.yScale(d.y)})).attr("r",(function(d){return d.r})).attr("data-n",(function(d){return d.key})),shapes.enter().append("circle").attr("class",circleClass).attr("cx",(function(d){return theGraph.xScale(d.x)})).attr("cy",(function(d){return theGraph.yScale(d.y)})).style("opacity",1e-6).attr("r",1e-6).transition(tslow).ease(te).style("opacity",1).attr("r",(function(d){return d.r})),shapes},this.hideItems=function(selector){d3.select("#"+theGraph.graphID).selectAll(selector).classed("kcvsGraph-hide",!0)},this.showItems=function(selector){d3.select("#"+theGraph.graphID).selectAll(selector).classed("kcvsGraph-hideLine",!1)},this.removeLines=function(selector){var tslow=d3.transition().duration(this.slowTransition);d3.select("#"+theGraph.graphID).selectAll(selector).transition(tslow).remove().style("opacity",1e-6)},this.getAxisLimits=function(){return{xmin:this.xmin,xmax:this.xmax,ymin:this.ymin,ymax:this.ymax}}):console.error("Bork! No element found with ID="+this.containerID)):console.error("Bork! Must specify containerID to place slider!")}